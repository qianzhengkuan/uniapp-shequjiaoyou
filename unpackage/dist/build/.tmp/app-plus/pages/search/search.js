(global["webpackJsonp"]=global["webpackJsonp"]||[]).push([["pages/search/search"],{"41e2":function(t,e,n){"use strict";n.r(e);var o=n("eaee"),r=n("e04a");for(var i in r)"default"!==i&&function(t){n.d(e,t,(function(){return r[t]}))}(i);var s,a=n("f0c5"),u=Object(a["a"])(r["default"],o["b"],o["c"],!1,null,null,null,!1,o["a"],s);e["default"]=u.exports},6322:function(t,e,n){"use strict";(function(t){n("d1f3"),n("921b");o(n("66fd"));var e=o(n("41e2"));function o(t){return t&&t.__esModule?t:{default:t}}t(e.default)}).call(this,n("6e42")["createPage"])},8018:function(t,e,n){"use strict";(function(t,o){function r(t){return u(t)||a(t)||s(t)||i()}function i(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}function s(t,e){if(t){if("string"===typeof t)return c(t,e);var n=Object.prototype.toString.call(t).slice(8,-1);return"Object"===n&&t.constructor&&(n=t.constructor.name),"Map"===n||"Set"===n?Array.from(n):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?c(t,e):void 0}}function a(t){if("undefined"!==typeof Symbol&&Symbol.iterator in Object(t))return Array.from(t)}function u(t){if(Array.isArray(t))return c(t)}function c(t,e){(null==e||e>t.length)&&(e=t.length);for(var n=0,o=new Array(e);n<e;n++)o[n]=t[n];return o}Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0;var l=function(){Promise.all([n.e("common/vendor"),n.e("components/common/common-list")]).then(function(){return resolve(n("7993"))}.bind(null,n)).catch(n.oe)},p=function(){n.e("components/news/topic-list").then(function(){return resolve(n("0de6"))}.bind(null,n)).catch(n.oe)},f=function(){n.e("components/user-list/user-list").then(function(){return resolve(n("8b5a"))}.bind(null,n)).catch(n.oe)},h=function(){n.e("components/common/load-more").then(function(){return resolve(n("ba05"))}.bind(null,n)).catch(n.oe)},d={components:{commonList:l,topicList:p,userList:f,loadMore:h},data:function(){return{searchText:"",list:[],searchList:[],type:"post",loadmore:"上拉加载更多",page:1}},onNavigationBarSearchInputChanged:function(t){this.searchText=t.text},onNavigationBarButtonTap:function(t){0===t.index&&this.searchEvent()},onLoad:function(e){var n=this;e.type&&(this.type=e.type);var o="帖子";switch(this.type){case"post":o="帖子",t.$on("updateFollowOrSupport",(function(t){switch(t.type){case"follow":n.follow(t.data.user_id);break;default:break}}));break;case"topic":o="话题";break;case"user":o="用户";break}var r=this.$mp.page.$getAppWebview(),i=r.getStyle().titleNView;i.searchInput.placeholder="搜索"+o,r.setStyle({titleNView:i});var s=t.getStorageSync("historySeachText");s&&(this.list=JSON.parse(s))},onUnload:function(){"post"===this.type&&t.$off("updateFollowOrSupport",(function(t){}))},onPullDownRefresh:function(){if(""===this.searchText)return t.stopPullDownRefresh();this.getData(!0,(function(){t.stopPullDownRefresh()}))},onReachBottom:function(){"上拉加载更多"===this.loadmore&&(this.loadmore="加载中...",this.getData(!1))},methods:{follow:function(e){this.searchList.forEach((function(t){t.user_id===e&&(t.isFollow=!0)})),t.showToast({title:"关注成功"})},doSupport:function(e){this.searchList.forEach((function(t){t.id===e.id&&(""===t.support.type?t.support[e.type+"_count"]++:"support"===t.support.type&&"unsupport"===e.type?(t.support.support_count--,t.support.unsupport_count++):"unsupport"===t.support.type&&"support"===e.type&&(t.support.support_count++,t.support.unsupport_count--),t.support.type=e.type)}));var n="support"===e.type?"顶":"踩";t.showToast({title:n+"成功"})},clickSearchHistory:function(t){this.searchText=t,this.searchEvent()},searchEvent:function(){var e=this;t.hideKeyboard();var n=this.list.findIndex((function(t){return t===e.searchText}));-1!==n?this.$U.__toFirst(this.list,n):this.list.unshift(this.searchText),t.setStorageSync("historySeachText",JSON.stringify(this.list)),this.getData()},getData:function(){var e=this,n=!(arguments.length>0&&void 0!==arguments[0])||arguments[0],i=arguments.length>1&&void 0!==arguments[1]&&arguments[1];t.showLoading({title:"加载中...",mask:!1}),this.page=n?1:this.page+1,this.$H.post("/search/"+this.type,{keyword:this.searchText,page:this.page}).then((function(s){var a=[];switch(e.type){case"post":a=s.list.map((function(t){return e.$U.formatCommonList(t)}));break;case"topic":a=s.list.map((function(t){return{id:t.id,cover:t.titlepic,title:t.title,desc:t.desc,today_count:t.todaypost_count,news_count:t.post_count}}));break;case"user":a=s.list.map((function(t){return{id:t.id,avatar:t.userpic,username:t.username,sex:t.userinfo.sex,age:t.userinfo.age,isFollow:!1}}));break}o("log",JSON.stringify(a)," at pages\\search\\search.vue:260"),e.searchList=n?r(a):[].concat(r(e.searchList),r(a)),e.loadmore=a.length<10?"没有更多了":"上拉加载更多",t.hideLoading(),"function"===typeof i&&i()})).catch((function(n){e.page--,t.hideLoading(),"function"===typeof i&&i()}))}}};e.default=d}).call(this,n("6e42")["default"],n("0de9")["default"])},e04a:function(t,e,n){"use strict";n.r(e);var o=n("8018"),r=n.n(o);for(var i in o)"default"!==i&&function(t){n.d(e,t,(function(){return o[t]}))}(i);e["default"]=r.a},eaee:function(t,e,n){"use strict";var o={"user-list":function(){return n.e("components/user-list/user-list").then(n.bind(null,"8b5a"))}},r=function(){var t=this,e=t.$createElement;t._self._c},i=[];n.d(e,"b",(function(){return r})),n.d(e,"c",(function(){return i})),n.d(e,"a",(function(){return o}))}},[["6322","common/runtime","common/vendor"]]]);